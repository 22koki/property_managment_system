<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>View Properties</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        .property {
            border: 2px solid #ddd;
            padding: 15px;
            margin: 10px 0;
            cursor: pointer;
        }
        .property.selected {
            border-color: red;
            background-color: #ffe6e6;
        }
    </style>
</head>
<body>
    <div class="container mt-5">
        <h1 class="text-center">View Properties</h1>
        
        <div class="property-actions text-center mt-3">
            <a href="add_propert.html" class="btn btn-primary" id="add-property-btn">Add Property</a>
            <button id="update-property-btn" class="btn btn-warning" disabled>Update Property</button>
            <button id="delete-property-btn" class="btn btn-danger" disabled>Delete Selected Property</button>
        </div>
        
        <section class="property-list mt-4">
            <!-- Properties will be loaded here -->
        </section>
    </div>

    <script>
        let selectedProperty = null; // Holds the selected property data

// Function to enable/disable the Update button when a property is selected
$(".property-item").click(function () {
    $(".property-item").removeClass("selected"); // Remove previous selection
    $(this).addClass("selected"); // Highlight selected property
    selectedProperty = $(this); // Store selected property
    $("#update-property-btn").prop("disabled", false); // Enable Update button
    $("#delete-property-btn").prop("disabled", false); // Enable Delete button
});

// Redirect to update page
$("#update-property-btn").click(function() {
    if (selectedProperty) {
        let propertyId = selectedProperty.data("id");
        window.location.href = `add_propert.html?id=${propertyId}`; // Ensure this filename exists
    }
});

        $(document).ready(function() {
            let selectedProperty = null;

            // Function to fetch properties from the database
            function fetchProperties() {
                $.getJSON("http://127.0.0.1:5000/properties", function(data) {
                    let propertyList = $(".property-list");
                    propertyList.empty(); // Clear existing content

                    data.forEach(function(property) {
                        let propertyHtml = `
                            <div class="property" data-id="${property.property_id}">
                                <h2>${property.name}</h2>
                                <p><strong>Owner:</strong> ${property.owner}</p>
                                <p><strong>Location:</strong> ${property.location}</p>
                                <p><strong>Type:</strong> ${property.property_type}</p>
                                <p><strong>Price:</strong> KES ${property.price.toLocaleString()}</p>
                                <p><strong>Bedrooms:</strong> ${property.bedrooms}</p>
                                <p><strong>Available Units:</strong> ${property.available_units}</p>
                                <p><strong>Size:</strong> ${property.size}</p>
                                <p><strong>Description:</strong> ${property.description || "N/A"}</p>
                            </div>
                        `;
                        propertyList.append(propertyHtml);
                    });
                });
            }

            fetchProperties(); // Load properties when page loads

            // Select property on click
            $(document).on("click", ".property", function() {
                $(".property").removeClass("selected");  // Remove highlight from others
                $(this).addClass("selected");  // Highlight clicked one
                selectedProperty = $(this);  // Store selected property
                $("#delete-property-btn, #update-property-btn").prop("disabled", false);  // Enable buttons
            });

            // Delete selected property
            $("#delete-property-btn").click(function() {
                if (selectedProperty) {
                    let propertyId = selectedProperty.data("id");

                    $.ajax({
                        url: `http://127.0.0.1:5000/properties/${propertyId}`,
                        type: "DELETE",
                        success: function(response) {
                            alert("Property deleted successfully!");
                            fetchProperties(); // Refresh properties
                            $("#delete-property-btn, #update-property-btn").prop("disabled", true);
                            selectedProperty = null;
                        },
                        error: function() {
                            alert("Error deleting property.");
                        }
                    });
                }
            });

            // Redirect to update page
            $("#update-property-btn").click(function() {
                if (selectedProperty) {
                    let propertyId = selectedProperty.data("id");
                    window.location.href = `add_propert.html?id=${propertyId}`;
                }
            });
        });
    </script>
</body>
</html>
